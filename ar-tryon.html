<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Try-On - Body Tracking</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/ar.css" rel="stylesheet">
    
    <!-- TensorFlow.js - More reliable than MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet@2.2.2/dist/posenet.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-segmentation@1.0.2/dist/body-segmentation.min.js"></script>
</head>
<body class="ar-body">
    <!-- AR Container -->
    <div class="ar-container">
        <!-- Camera Setup -->
        <div class="camera-container">
            <video id="video" autoplay muted playsinline></video>
            <canvas id="output-canvas"></canvas>
            
            <!-- Body Analysis Display -->
            <div class="body-info-overlay">
                <div class="info-item">
                    <span>üë§ Body Detected:</span>
                    <span id="body-status" class="status-badge">‚ùå</span>
                </div>
                <div class="info-item">
                    <span>üéØ Pose Score:</span>
                    <span id="pose-score">0%</span>
                </div>
                <div class="info-item">
                    <span>üìè Size Rec:</span>
                    <span id="size-rec" class="size-badge">M</span>
                </div>
            </div>
        </div>

        <!-- AR Controls -->
        <div class="ar-controls-bottom">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <!-- Clothing Selection -->
                    <div class="col-md-4">
                        <div class="clothing-selector">
                            <h6 class="text-white mb-2">Select Clothing:</h6>
                            <div class="clothing-grid">
                                <button class="cloth-btn active" data-type="tshirt" onclick="selectClothingType('tshirt')">
                                    <i class="fas fa-tshirt"></i>
                                    <span>T-Shirt</span>
                                </button>
                                <button class="cloth-btn" data-type="hoodie" onclick="selectClothingType('hoodie')">
                                    <i class="fas fa-hoodie"></i>
                                    <span>Hoodie</span>
                                </button>
                                <button class="cloth-btn" data-type="dress" onclick="selectClothingType('dress')">
                                    <i class="fas fa-female"></i>
                                    <span>Dress</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Color Selection -->
                    <div class="col-md-4 text-center">
                        <h6 class="text-white mb-2">Colors & Size:</h6>
                        <div class="color-selector mb-2">
                            <button class="color-dot active" style="background: #ff6b6b" data-color="#ff6b6b" onclick="changeColor('#ff6b6b')"></button>
                            <button class="color-dot" style="background: #4ecdc4" data-color="#4ecdc4" onclick="changeColor('#4ecdc4')"></button>
                            <button class="color-dot" style="background: #45b7d1" data-color="#45b7d1" onclick="changeColor('#45b7d1')"></button>
                            <button class="color-dot" style="background: #96ceb4" data-color="#96ceb4" onclick="changeColor('#96ceb4')"></button>
                            <button class="color-dot" style="background: #feca57" data-color="#feca57" onclick="changeColor('#feca57')"></button>
                        </div>
                        <div class="size-selector">
                            <button class="size-btn" data-size="xs">XS</button>
                            <button class="size-btn active" data-size="m">M</button>
                            <button class="size-btn" data-size="l">L</button>
                            <button class="size-btn" data-size="xl">XL</button>
                        </div>
                    </div>
                    
                    <!-- Actions -->
                    <div class="col-md-4 text-end">
                        <div class="action-buttons">
                            <button class="btn btn-success me-2" onclick="capturePhoto()">
                                <i class="fas fa-camera me-1"></i>Capture
                            </button>
                            <button class="btn btn-warning me-2" onclick="addToCartFromAR()">
                                <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                            </button>
                            <a href="products.html" class="btn btn-outline-light">
                                <i class="fas fa-times me-1"></i>Exit
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div class="ar-loading" id="loading">
            <div class="loading-content">
                <div class="spinner-border text-warning mb-3"></div>
                <h4 class="text-white">Loading AR Body Tracking...</h4>
                <p class="text-white-50">Please wait while we initialize the camera and AI models</p>
                <div class="progress mt-3">
                    <div class="progress-bar bg-warning progress-bar-striped progress-bar-animated" 
                         id="progress-bar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Error Screen -->
        <div class="ar-error d-none" id="error">
            <div class="error-content text-center">
                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                <h4 class="text-white">Camera Access Required</h4>
                <p class="text-white-50 mb-4">Please allow camera access to use AR try-on feature</p>
                <button class="btn btn-warning me-2" onclick="retryCamera()">
                    <i class="fas fa-redo me-1"></i>Try Again
                </button>
                <a href="products.html" class="btn btn-outline-light">
                    <i class="fas fa-arrow-left me-1"></i>Go Back
                </a>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="captureModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header border-0">
                    <h5 class="modal-title">üì∏ AR Try-On Capture</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <canvas id="capture-canvas" class="img-fluid rounded mb-3"></canvas>
                    <div class="capture-actions">
                        <button class="btn btn-primary me-2" onclick="downloadCapture()">
                            <i class="fas fa-download me-1"></i>Download
                        </button>
                        <button class="btn btn-success" onclick="addToCartFromCapture()">
                            <i class="fas fa-shopping-cart me-1"></i>Add to Cart
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/ar-working.js"></script>
</body>
</html>
